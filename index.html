<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Product Store</title>
<style>
  /* Reset & base */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
body {
  font-family: 'Segoe UI', 'Roboto', Tahoma, Geneva, Verdana, sans-serif;
  background: #f4f6f9;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  color: #1a1a1a;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
a, button {
  font-family: inherit;
  text-decoration: none;
  color: inherit;
  cursor: pointer;
}

/* Header */
header {
  background: linear-gradient(90deg, #2a2a72, #009ffd);
  color: #ffffff;
  padding: 1.5rem 1rem;
  text-align: center;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  user-select: none;
  transition: background 0.5s ease;
}
header h1 {
  margin: 0;
  font-size: 2.6rem;
  font-weight: 800;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4);
  animation: fadeIn 1s ease-in-out;
}
header:hover {
  background: linear-gradient(90deg, #3b3b9a, #00b7ff);
}

/* Search bar */
#searchBar {
  width: 100%;
  max-width: 550px;
  margin: 2rem auto;
  padding: 0.9rem 1.2rem;
  font-size: 1.25rem;
  border-radius: 10px;
  border: 2px solid #d0d0d0;
  display: block;
  transition: all 0.3s ease;
  box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.1);
  background: #ffffff;
}
#searchBar:focus {
  outline: none;
  border-color: #0066cc;
  box-shadow: 0 0 10px rgba(0, 102, 204, 0.6);
  transform: scale(1.01);
}
#searchBar::placeholder {
  color: #999;
  font-style: italic;
}

/* Filter controls */
#filterContainer {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  justify-content: center;
  margin: 1rem 0;
}
#filterContainer select,
#filterContainer input[type="range"] {
  padding: 0.7rem 1.2rem;
  border-radius: 12px;
  border: 2px solid #c0c0c0;
  font-size: 1.15rem;
  margin: 0.6rem 0;
  transition: all 0.3s ease;
  background: #ffffff;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
}
#filterContainer select:hover,
#filterContainer input[type="range"]:hover {
  border-color: #0066cc;
  box-shadow: 0 2px 6px rgba(0, 102, 204, 0.4);
}
#filterContainer select:focus,
#filterContainer input[type="range"]:focus {
  outline: none;
  border-color: #004080;
  box-shadow: 0 0 8px rgba(0, 64, 128, 0.6);
}
#filterContainer label {
  font-size: 1.1rem;
  font-weight: 600;
  color: #333;
  margin-right: 0.5rem;
}

/* Main container */
main {
  flex: 1;
  max-width: 1400px;
  margin: 0 auto;
  padding: 1.5rem 2.5rem 4rem;
  display: flex;
  flex-wrap: wrap;
  gap: 2rem;
  justify-content: center;
  background: linear-gradient(180deg, #ffffff, #e8eef4);
  border-radius: 20px;
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
  min-height: 75vh;
}

/* Product card */
.product {
  background: #ffffff;
  border-radius: 18px;
  box-shadow:
    0 6px 10px rgba(50, 50, 93, 0.15),
    0 2px 4px rgba(0, 0, 0, 0.1);
  padding: 1.5rem;
  width: 300px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
  cursor: pointer;
  user-select: none;
}
.product:hover, .product:focus-within {
  transform: translateY(-12px) scale(1.03);
  box-shadow:
    0 15px 25px rgba(50, 50, 93, 0.25),
    0 8px 8px rgba(0, 0, 0, 0.15);
}
.product img {
  width: 100%;
  height: 200px;
  object-fit: contain;
  margin-bottom: 1rem;
  border-bottom: 3px solid #f0f0f0;
  border-radius: 15px 15px 0 0;
  transition: transform 0.4s ease;
}
.product:hover img {
  transform: scale(1.08);
}
.product h3 {
  font-size: 1.4rem;
  margin: 0.6rem 0 0.8rem;
  min-height: 56px;
  color: #1a1a1a;
  font-weight: 700;
  letter-spacing: 0.03em;
}
.product p {
  font-weight: 700;
  color: #333;
  margin: 0.8rem 0 1.2rem;
  font-size: 1.2rem;
}
.product button {
  background-color: #28a745;
  border: none;
  color: #ffffff;
  padding: 0.85rem 1.4rem;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 700;
  font-size: 1.15rem;
  transition: all 0.35s ease;
  box-shadow: 0 8px 16px rgba(40, 167, 69, 0.4);
}
.product button:hover,
.product button:focus {
  background-color: #218838;
  transform: scale(1.06);
  box-shadow: 0 10px 24px rgba(33, 136, 56, 0.65);
}

/* Cart button fixed on top right */
#cartBtn {
  position: fixed;
  top: 30px;
  right: 30px;
  background: #007bff;
  color: #ffffff;
  border: none;
  padding: 1rem 1.8rem;
  font-size: 1.2rem;
  border-radius: 60px;
  cursor: pointer;
  z-index: 300;
  box-shadow: 0 8px 20px rgba(0, 123, 255, 0.55);
  display: flex;
  align-items: center;
  gap: 0.8rem;
  transition: all 0.3s ease;
}
#cartBtn:hover, #cartBtn:focus {
  background-color: #0056b3;
  transform: scale(1.12);
  box-shadow: 0 10px 28px rgba(0, 86, 179, 0.85);
}
#cartCount {
  background: #dc3545;
  border-radius: 50%;
  padding: 0 12px;
  font-size: 1.1rem;
  font-weight: 700;
  min-width: 28px;
  text-align: center;
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.35);
  animation: pulse 1.5s infinite;
}

/* Cart modal */
#cartModal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.65);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 400;
  padding: 1.5rem;
  backdrop-filter: blur(5px);
}
#cartModal.active {
  display: flex;
  animation: fadeInModal 0.3s ease-in-out;
}
#cartContent {
  background: #ffffff;
  width: 95%;
  max-width: 700px;
  max-height: 90vh;
  overflow-y: auto;
  border-radius: 25px;
  padding: 2rem 2.5rem 2.5rem;
  box-shadow:
    0 16px 32px rgba(0, 0, 0, 0.3),
    0 12px 12px rgba(0, 0, 0, 0.25);
  display: flex;
  flex-direction: column;
  position: relative;
}
#cartContent h2 {
  margin-top: 0;
  text-align: center;
  font-weight: 900;
  font-size: 2.2rem;
  letter-spacing: 0.07em;
  color: #007bff;
  margin-bottom: 1.2rem;
}
#closeCart {
  position: absolute;
  top: 20px;
  right: 20px;
  background: transparent;
  border: none;
  font-size: 2.4rem;
  cursor: pointer;
  color: #666;
  transition: all 0.3s ease;
}
#closeCart:hover {
  color: #dc3545;
  transform: rotate(90deg);
}
#closeCart:focus {
  outline: none;
  color: #dc3545;
  box-shadow: 0 0 10px #dc3545;
}

/* Cart items */
#cartItems {
  flex: 1;
  margin-top: 1.5rem;
}
.cart-item {
  display: flex;
  gap: 1.5rem;
  border-bottom: 2px solid #e0e0e0;
  padding: 1.2rem 0;
  align-items: center;
  transition: background-color 0.3s ease;
}
.cart-item:hover {
  background-color: #f8fafc;
}
.cart-item img {
  width: 80px;
  height: 80px;
  object-fit: contain;
  border-radius: 12px;
  box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
  transition: transform 0.3s ease;
}
.cart-item img:hover {
  transform: scale(1.08);
}
.cart-details {
  flex: 1;
  min-width: 140px;
}
.cart-details h4 {
  margin: 0 0 0.5rem;
  font-weight: 700;
  font-size: 1.15rem;
  color: #1a1a1a;
}
.cart-details p {
  margin: 0;
  font-weight: 700;
  color: #444;
  font-size: 1.05rem;
}
.quantity-control {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  margin-top: 0.6rem;
}
.quantity-control input {
  width: 70px;
  text-align: center;
  font-size: 1.15rem;
  border: 2px solid #c0c0c0;
  border-radius: 10px;
  padding: 0.4rem 0;
  transition: all 0.3s ease;
}
.quantity-control input:focus {
  outline: none;
  border-color: #0066cc;
  box-shadow: 0 0 10px rgba(0, 102, 204, 0.6);
}
.remove-btn {
  background: #dc3545;
  border: none;
  color: #ffffff;
  padding: 0.6rem 1rem;
  border-radius: 10px;
  cursor: pointer;
  font-size: 1.05rem;
  font-weight: 700;
  transition: all 0.3s ease;
}
.remove-btn:hover {
  background: #bb2d3b;
  transform: scale(1.06);
}

/* Cart footer */
#cartFooter {
  margin-top: 2rem;
  text-align: right;
  font-weight: 900;
  font-size: 1.6rem;
  color: #007bff;
}
#clearCart {
  background: #ffc107;
  border: none;
  padding: 0.8rem 1.5rem;
  border-radius: 12px;
  cursor: pointer;
  margin-top: 1.2rem;
  font-weight: 700;
  font-size: 1.25rem;
  color: #222;
  box-shadow: 0 6px 16px rgba(255, 193, 7, 0.55);
  transition: all 0.3s ease;
}
#clearCart:hover, #clearCart:focus {
  background: #e0a800;
  transform: scale(1.06);
}

/* Loading spinner */
#loadingSpinner {
  width: 80px;
  height: 80px;
  border: 10px solid #d0d0d0;
  border-top-color: #007bff;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  margin: 4rem auto;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Error message */
#errorMessage {
  color: #dc3545;
  text-align: center;
  margin: 2.5rem 0;
  font-weight: 700;
  font-size: 1.3rem;
  animation: shake 0.5s ease-in-out;
}

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes fadeInModal {
  from { opacity: 0; }
  to { opacity: 1; }
}
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}

/* Responsive design */
@media (max-width: 1024px) {
  main {
    padding: 1rem 1.5rem 3rem;
    gap: 1.5rem;
  }
  .product {
    width: 280px;
  }
  #cartContent {
    max-width: 80vw;
  }
}
@media (max-width: 700px) {
  header h1 {
    font-size: 2rem;
  }
  #searchBar {
    max-width: 90vw;
    font-size: 1.1rem;
  }
  main {
    justify-content: center;
    padding: 1rem;
  }
  .product {
    width: 90vw;
  }
  #cartBtn {
    top: 20px;
    right: 20px;
    padding: 0.8rem 1.2rem;
    font-size: 1rem;
  }
  #cartContent {
    max-width: 95vw;
    max-height: 90vh;
    padding: 1.5rem;
  }
  #cartContent h2 {
    font-size: 1.8rem;
  }
}
@media (max-width: 480px) {
  header h1 {
    font-size: 1.8rem;
  }
  #searchBar {
    padding: 0.7rem;
    font-size: 1rem;
  }
  #filterContainer select,
  #filterContainer input[type="range"] {
    font-size: 1rem;
    padding: 0.5rem;
  }
  .product {
    padding: 1rem;
  }
  .product img {
    height: 180px;
  }
  .cart-item img {
    width: 60px;
    height: 60px;
  }
  .quantity-control input {
    width: 50px;
    font-size: 1rem;
  }
}
</style>
</head>
<body>

<header>
  <h1>My Product Store</h1>
</header>

<input type="text" id="searchBar" placeholder="Search products..." />

<main id="productContainer">
  <!-- Products will be injected here -->
</main>

<button id="cartBtn">
  Cart (<span id="cartCount">0</span>)
</button>

<div id="filterContainer" style="display:flex; flex-wrap:wrap; gap:1rem; justify-content:center; margin:1rem;">
  <select id="categoryFilter">
    <option value="">All Categories</option>
    <option value="electronics">Electronics</option>
    <option value="fashion">Fashion</option>
    <option value="home">Home</option>
  </select>

  <select id="ratingFilter">
    <option value="">All Ratings</option>
    <option value="4">4★ & up</option>
    <option value="3">3★ & up</option>
    <option value="2">2★ & up</option>
  </select>

  <input type="range" id="priceFilter" min="0" max="1000" step="10" value="1000" />
  <label for="priceFilter">Max Price: $<span id="priceValue">1000</span></label>

  <select id="sortSelect">
    <option value="">Sort By</option>
    <option value="priceAsc">Price: Low to High</option>
    <option value="priceDesc">Price: High to Low</option>
    <option value="nameAsc">Name: A to Z</option>
    <option value="nameDesc">Name: Z to A</option>
  </select>
</div>

<div id="cartModal">
  <div id="cartContent">
    <button id="closeCart">&times;</button>
    <h2>Your Cart</h2>
    <div id="cartItems"></div>  <!-- Only one cart items container -->
    <div id="cartFooter">
      Total: $<span id="cartTotal">0.00</span>
    </div>
    <button id="clearCart">Clear Cart</button>  <!-- Only one clear cart button -->
  </div>
</div>


<div id="loadingSpinner" style="display:none;"></div>
<div id="errorMessage"></div>

<!-- Your JS would go here, like fetching product data, handling cart logic, etc. -->
<script>
 // DOM Elements
const productContainer = document.getElementById('productContainer');
const cartBtn = document.getElementById('cartBtn');
const cartCount = document.getElementById('cartCount');
const cartModal = document.getElementById('cartModal');
const closeCartBtn = document.getElementById('closeCart');
const cartItemsContainer = document.getElementById('cartItems');
const cartTotalEl = document.getElementById('cartTotal');
const clearCartBtn = document.getElementById('clearCart');
const searchBar = document.getElementById('searchBar');
const loadingSpinner = document.getElementById('loadingSpinner');
const errorMessage = document.getElementById('errorMessage');
const sortSelect = document.getElementById('sortSelect');
const categoryFilter = document.getElementById('categoryFilter');

// State management
const state = {
  products: [],
  cart: {},
  categories: new Set(),
  isLoading: false,
  error: null,
};

// Load cart from localStorage
function loadCart() {
  try {
    const savedCart = localStorage.getItem('cart');
    state.cart = savedCart ? JSON.parse(savedCart) : {};
  } catch (error) {
    console.warn('Error parsing saved cart:', error);
    state.cart = {};
    showError('Failed to load cart data.');
  }
}

// Save cart to localStorage
function saveCart() {
  try {
    localStorage.setItem('cart', JSON.stringify(state.cart));
  } catch (error) {
    console.error('Failed to save cart:', error);
    showError('Failed to save cart data.');
  }
}

// Update cart count badge
function updateCartCount() {
  const totalItems = Object.values(state.cart).reduce((sum, item) => sum + item.quantity, 0);
  cartCount.textContent = totalItems;
  cartCount.style.display = totalItems > 0 ? 'inline-block' : 'none';
  cartCount.setAttribute('aria-label', `Cart contains ${totalItems} items`);
}

// Format price with currency
function formatPrice(num, currency = 'USD') {
  return new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency,
    minimumFractionDigits: 2,
  }).format(num);
}

// Show error message with animation
function showError(message) {
  state.error = message;
  errorMessage.textContent = message;
  errorMessage.style.display = 'block';
  errorMessage.classList.add('shake');
  setTimeout(() => errorMessage.classList.remove('shake'), 500);
}

// Clear error message
function clearError() {
  state.error = null;
  errorMessage.textContent = '';
  errorMessage.style.display = 'none';
}

// Populate category filter
function populateCategoryFilter() {
  if (!categoryFilter) return;
  categoryFilter.innerHTML = '<option value="">All Categories</option>';
  state.categories.forEach(category => {
    const option = document.createElement('option');
    option.value = category;
    option.textContent = category.charAt(0).toUpperCase() + category.slice(1);
    categoryFilter.appendChild(option);
  });
}

// Render products with filtering and sorting
function renderProducts({ search = '', category = '', sort = 'title-asc' } = {}) {
  productContainer.innerHTML = '';
  clearError();

  let filteredProducts = [...state.products];

  // Apply search filter
  if (search) {
    filteredProducts = filteredProducts.filter(p =>
      p.title.toLowerCase().includes(search.toLowerCase())
    );
  }

  // Apply category filter
  if (category) {
    filteredProducts = filteredProducts.filter(p => p.category === category);
  }

  // Apply sorting
  filteredProducts.sort((a, b) => {
    switch (sort) {
      case 'price-asc':
        return a.price - b.price;
      case 'price-desc':
        return b.price - a.price;
      case 'title-desc':
        return b.title.localeCompare(a.title);
      case 'title-asc':
      default:
        return a.title.localeCompare(b.title);
    }
  });

  if (filteredProducts.length === 0) {
    productContainer.innerHTML = '<p style="text-align:center; width:100%; font-size:1.2rem;">No products found.</p>';
    return;
  }

  filteredProducts.forEach(product => {
    const productEl = document.createElement('div');
    productEl.className = 'product';
    productEl.setAttribute('tabindex', '0');
    productEl.innerHTML = `
      <img loading="lazy" src="${product.image}" alt="${product.title}" />
      <h3>${product.title}</h3>
      <p>${formatPrice(product.price)}</p>
      <button data-id="${product.id}" aria-label="Add ${product.title} to cart">Add to Cart</button>
    `;
    productContainer.appendChild(productEl);
  });

  if (search || category || sort !== 'title-asc') {
    productContainer.scrollIntoView({ behavior: 'smooth' });
  }
}

// Open cart modal
function openCart() {
  renderCartItems();
  cartModal.classList.add('active');
  cartModal.setAttribute('aria-hidden', 'false');
  cartItemsContainer.focus();
}

// Close cart modal
function closeCart() {
  cartModal.classList.remove('active');
  cartModal.setAttribute('aria-hidden', 'true');
  cartBtn.focus();
}

// Render cart items
function renderCartItems() {
  cartItemsContainer.innerHTML = '';

  if (Object.keys(state.cart).length === 0) {
    cartItemsContainer.innerHTML = '<p style="text-align:center; font-size:1.2rem;">Your cart is empty.</p>';
    cartTotalEl.textContent = formatPrice(0);
    return;
  }

  let total = 0;

  Object.values(state.cart).forEach(item => {
    total += item.price * item.quantity;

    const cartItemEl = document.createElement('div');
    cartItemEl.className = 'cart-item';
    cartItemEl.innerHTML = `
      <img src="${item.image}" alt="${item.title}" />
      <div class="cart-details">
        <h4>${item.title}</h4>
        <p>${formatPrice(item.price)} each</p>
        <div class="quantity-control">
          <label for="qty-${item.id}" class="visually-hidden">Quantity for ${item.title}</label>
          <input id="qty-${item.id}" type="number" min="1" max="99" value="${item.quantity}" data-id="${item.id}" aria-label="Quantity for ${item.title}" />
        </div>
      </div>
      <button class="remove-btn" data-id="${item.id}" aria-label="Remove ${item.title} from cart">Remove</button>
    `;
    cartItemsContainer.appendChild(cartItemEl);
  });

  cartTotalEl.textContent = formatPrice(total);
}

// Add product to cart
function addToCart(id) {
  const product = state.products.find(p => p.id === id);
  if (!product) return;

  if (state.cart[id]) {
    state.cart[id].quantity = Math.min(state.cart[id].quantity + 1, 99);
  } else {
    state.cart[id] = { ...product, quantity: 1 };
  }

  saveCart();
  updateCartCount();
  showNotification(`Added "${product.title}" to cart!`);
}

// Remove product from cart
function removeFromCart(id) {
  if (state.cart[id]) {
    const title = state.cart[id].title;
    delete state.cart[id];
    saveCart();
    updateCartCount();
    renderCartItems();
    showNotification(`Removed "${title}" from cart.`);
  }
}

// Update cart item quantity
function updateQuantity(id, quantity) {
  quantity = Math.max(1, Math.min(99, parseInt(quantity, 10) || 1));
  if (state.cart[id]) {
    state.cart[id].quantity = quantity;
    saveCart();
    updateCartCount();
    renderCartItems();
    showNotification(`Updated quantity for "${state.cart[id].title}".`);
  }
}

// Clear entire cart
function clearCart() {
  if (!confirm('Are you sure you want to clear the cart?')) return;
  state.cart = {};
  saveCart();
  updateCartCount();
  renderCartItems();
  showNotification('Cart cleared successfully.');
}

// Show notification
function showNotification(message) {
  const notification = document.createElement('div');
  notification.className = 'notification';
  notification.textContent = message;
  notification.style.cssText = `
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #28a745;
    color: white;
    padding: 1rem;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    z-index: 500;
    animation: slideIn 0.3s ease, slideOut 0.3s ease 2.7s forwards;
  `;
  document.body.appendChild(notification);
  setTimeout(() => notification.remove(), 3000);
}

// Debounce utility
function debounce(func, wait) {
  let timeout;
  return function (...args) {
    clearTimeout(timeout);
    timeout = setTimeout(() => func.apply(this, args), wait);
  };
}

// Throttle utility
function throttle(func, limit) {
  let inThrottle;
  return function (...args) {
    if (!inThrottle) {
      func.apply(this, args);
      inThrottle = true;
      setTimeout(() => (inThrottle = false), limit);
    }
  };
}

// Fetch products with caching
async function fetchProducts() {
  if (state.isLoading) return;
  state.isLoading = true;
  loadingSpinner.style.display = 'block';
  clearError();

  try {
    const cache = localStorage.getItem('productCache');
    const cacheTime = localStorage.getItem('productCacheTime');
    const now = Date.now();

    if (cache && cacheTime && now - cacheTime < 1000 * 60 * 30) {
      state.products = JSON.parse(cache);
      state.categories = new Set(state.products.map(p => p.category));
      renderProducts();
      populateCategoryFilter();
    } else {
      const res = await fetch('https://fakestoreapi.com/products');
      if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);
      state.products = await res.json();
      state.categories = new Set(state.products.map(p => p.category));
      localStorage.setItem('productCache', JSON.stringify(state.products));
      localStorage.setItem('productCacheTime', now.toString());
      renderProducts();
      populateCategoryFilter();
    }
  } catch (error) {
    console.error('Fetch error:', error);
    showError('Failed to load products. Please try again later.');
  } finally {
    state.isLoading = false;
    loadingSpinner.style.display = 'none';
  }
}

// Event listeners
function setupEventListeners() {
  // Product container click delegation
  productContainer.addEventListener('click', e => {
    if (e.target.tagName === 'BUTTON' && e.target.dataset.id) {
      addToCart(parseInt(e.target.dataset.id, 10));
    }
  });

  // Product container keyboard accessibility
  productContainer.addEventListener('keydown', e => {
    if (e.key === 'Enter' && e.target.classList.contains('product')) {
      const button = e.target.querySelector('button');
      if (button) button.click();
    }
  });

  // Cart button click
  cartBtn.addEventListener('click', openCart);

  // Close cart button click
  closeCartBtn.addEventListener('click', closeCart);

  // Close cart on outside click
  cartModal.addEventListener('click', e => {
    if (e.target === cartModal) closeCart();
  });

  // Cart modal keyboard accessibility
  cartModal.addEventListener('keydown', e => {
    if (e.key === 'Escape') closeCart();
  });

  // Cart items click delegation
  cartItemsContainer.addEventListener('click', e => {
    if (e.target.classList.contains('remove-btn')) {
      removeFromCart(parseInt(e.target.dataset.id, 10));
    }
  });

  // Cart items quantity input
  cartItemsContainer.addEventListener('input', debounce(e => {
    if (e.target.tagName === 'INPUT' && e.target.type === 'number') {
      updateQuantity(parseInt(e.target.dataset.id, 10), e.target.value);
    }
  }, 300));

  // Clear cart button
  clearCartBtn.addEventListener('click', clearCart);

  // Search input
  searchBar.addEventListener('input', debounce(e => {
    renderProducts({
      search: e.target.value,
      category: categoryFilter?.value || '',
      sort: sortSelect?.value || 'title-asc',
    });
  }, 300));

  // Sort select
  if (sortSelect) {
    sortSelect.addEventListener('change', e => {
      renderProducts({
        search: searchBar.value,
        category: categoryFilter?.value || '',
        sort: e.target.value,
      });
    });
  }

  // Category filter
  if (categoryFilter) {
    categoryFilter.addEventListener('change', e => {
      renderProducts({
        search: searchBar.value,
        category: e.target.value,
        sort: sortSelect?.value || 'title-asc',
      });
    });
  }

  // Handle window resize for responsive adjustments
  window.addEventListener('resize', throttle(() => {
    renderProducts({
      search: searchBar.value,
      category: categoryFilter?.value || '',
      sort: sortSelect?.value || 'title-asc',
    });
  }, 100));
}

// Initialize app
function initializeApp() {
  loadCart();
  updateCartCount();
  fetchProducts();
  setupEventListeners();

  // Add notification styles to document
  const style = document.createElement('style');
  style.textContent = `
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
    }
    @keyframes slideIn {
      from { transform: translateY(100px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    @keyframes slideOut {
      from { transform: translateY(0); opacity: 1; }
      to { transform: translateY(100px); opacity: 0; }
    }
  `;
  document.head.appendChild(style);
}

// Start app
document.addEventListener('DOMContentLoaded', initializeApp);
</script>



</body>
</html>
